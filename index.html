<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>3D Mario HTML5</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #5c94fc; }
        #ui {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-family: Arial, sans-serif;
            font-size: 20px;
            text-shadow: 2px 2px black;
        }
    </style>
</head>
<body>
    <div id="ui">Mozgás: Nyilak / WASD | Ugrás: Space</div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        // --- JÁTÉK BEÁLLÍTÁSAI ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x5c94fc); // Mario égkék háttér
        
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Fények
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        const sunLight = new THREE.DirectionalLight(0xffffff, 0.8);
        sunLight.position.set(10, 20, 10);
        scene.add(sunLight);

        // --- 3. JAVÍTÁS: HÁTTÉR ÉS PÁLYA ---
        // Talaj (zöld fű)
        const groundGeo = new THREE.BoxGeometry(100, 2, 10);
        const groundMat = new THREE.MeshPhongMaterial({ color: 0x228b22 });
        const ground = new THREE.Mesh(groundGeo, groundMat);
        ground.position.y = -1;
        scene.add(ground);

        // Akadályok (Kockák mint az első képen)
        function createBlock(x, y, z) {
            const blockGeo = new THREE.BoxGeometry(1, 1, 1);
            const blockMat = new THREE.MeshPhongMaterial({ color: 0xff4500 }); // Téglavörös
            const block = new THREE.Mesh(blockGeo, blockMat);
            block.position.set(x, y, z);
            scene.add(block);
            return block;
        }
        const blocks = [createBlock(5, 2, 0), createBlock(6, 2, 0), createBlock(7, 2, 0)];

        // --- 1. JAVÍTÁS: MARIO (HITBOX MEGEGYEZIK A MÉRETTEL) ---
        const marioGroup = new THREE.Group();
        
        // Mario teste (piros kocka, de 3D-ben)
        const bodyGeo = new THREE.BoxGeometry(0.8, 1, 0.8);
        const bodyMat = new THREE.MeshPhongMaterial({ color: 0xff0000 });
        const body = new THREE.Mesh(bodyGeo, bodyMat);
        marioGroup.add(body);

        // Mario sapka (hogy lássuk merre néz)
        const hatGeo = new THREE.BoxGeometry(0.8, 0.2, 0.4);
        const hatMat = new THREE.MeshPhongMaterial({ color: 0xff0000 });
        const hat = new THREE.Mesh(hatGeo, hatMat);
        hat.position.set(0, 0.5, 0.2); 
        marioGroup.add(hat);

        scene.add(marioGroup);
        marioGroup.position.y = 0.5;

        // --- IRÁNYÍTÁS ÉS MOZGÁS ---
        const keys = {};
        window.addEventListener('keydown', (e) => keys[e.code] = true);
        window.addEventListener('keyup', (e) => keys[e.code] = false);

        let velocityY = 0;
        let isJumping = false;
        const speed = 0.15;

        camera.position.z = 10;
        camera.position.y = 3;

        function animate() {
            requestAnimationFrame(animate);

            // Mozgás logika
            if (keys['ArrowLeft'] || keys['KeyA']) {
                marioGroup.position.x -= speed;
                // --- 2. JAVÍTÁS: IRÁNY (Balra néz) ---
                marioGroup.rotation.y = -Math.PI / 2;
            }
            if (keys['ArrowRight'] || keys['KeyD']) {
                marioGroup.position.x += speed;
                // --- 2. JAVÍTÁS: IRÁNY (Jobbra néz) ---
                marioGroup.rotation.y = Math.PI / 2;
            }

            // Ugrás
            if (keys['Space'] && !isJumping) {
                velocityY = 0.25;
                isJumping = true;
            }

            // Gravitáció
            marioGroup.position.y += velocityY;
            if (marioGroup.position.y > 0.5) {
                velocityY -= 0.01;
            } else {
                marioGroup.position.y = 0.5;
                velocityY = 0;
                isJumping = false;
            }

            // Kamera követés
            camera.position.x = marioGroup.position.x;
            camera.lookAt(marioGroup.position);

            renderer.render(scene, camera);
        }

        animate();

        // Ablak átméretezés kezelése
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
