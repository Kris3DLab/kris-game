<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Szuper Mario - Pro Kiad√°s (Kris Verzi√≥)</title>
    <style>
        body { 
            margin: 0; 
            background: linear-gradient(180deg, #87CEEB 0%, #98D8E8 100%); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            font-family: 'Segoe UI', Tahoma, sans-serif; 
            overflow: hidden; 
        }
        #wrapper { 
            position: relative; 
            border: 8px solid #333; 
            border-radius: 20px; 
            box-shadow: 0 0 60px rgba(0,0,0,0.8), inset 0 0 20px rgba(255,255,255,0.1); 
            overflow: hidden; 
        }
        canvas { 
            display: block; 
            image-rendering: pixelated; 
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
        /* UI Jav√≠tva */
        #ui { 
            position: absolute; 
            top: 15px; 
            left: 20px; 
            right: 20px; 
            display: flex; 
            justify-content: space-between; 
            color: #fff; 
            font-size: 24px; 
            font-weight: bold; 
            text-shadow: 3px 3px 0 #000; 
            pointer-events: none; 
            z-index: 10; 
            background: rgba(0,0,0,0.3); 
            padding: 10px 20px; 
            border-radius: 15px; 
            backdrop-filter: blur(10px);
        }
        #hearts { font-size: 28px; }
        .screen { 
            position: absolute; 
            inset: 0; 
            background: rgba(0,0,0,0.85); 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            color: white; 
            z-index: 20; 
            text-align: center; 
            backdrop-filter: blur(10px); 
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        h1 { 
            font-size: 60px; 
            margin: 0 0 10px; 
            background: linear-gradient(45deg, #ff4500, #ff8c00); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            text-shadow: 4px 4px #000; 
            font-weight: 900;
        }
        p { font-size: 24px; margin: 0 0 20px; }
        button { 
            padding: 15px 40px; 
            font-size: 26px; 
            cursor: pointer; 
            background: linear-gradient(45deg, #e52521, #ff4500); 
            color: white; 
            border: 4px solid #fff; 
            border-radius: 40px; 
            margin-top: 10px; 
            font-weight: bold; 
            transition: all 0.3s; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.4);
        }
        button:hover { 
            transform: scale(1.15) rotate(2deg); 
            background: linear-gradient(45deg, #ff4500, #ff8c00); 
            box-shadow: 0 10px 25px rgba(0,0,0,0.6);
        }
        button:active { transform: scale(1.05) rotate(0); }
    </style>
</head>
<body>
<div id="wrapper">
    <div id="ui">
        <div>SZINT: <span id="lvlDisplay">1</span></div>
        <div id="powerLabel" style="color: #ffff00; text-transform: uppercase; font-size: 20px;"></div>
        <div id="hearts">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
        <div style="font-size:20px">PONT: <span id="scDisplay">0</span></div>
    </div>
    <div id="menu" class="screen">
        <h1>üïπÔ∏è KRIS SUPER MARIO üïπÔ∏è</h1>
        <p>A Legjobb Magyar Kaland! Gy≈ëzd le a szinteket!</p>
        <p>IR√ÅNY√çT√ÅS: Nyilak ‚¨ÖÔ∏è‚û°Ô∏è‚¨ÜÔ∏è (ugr√°s Space), F = T≈±zgoly√≥</p>
        <button onclick="startGame()">üöÄ J√ÅT√âK IND√çT√ÅSA üöÄ</button>
    </div>
    <div id="fail" class="screen" style="display:none">
        <h1>üíÄ MEGHALT√ÅL üíÄ</h1>
        <p>Pr√≥b√°ld √∫jra, Kris!</p>
        <button onclick="location.reload()">üîÑ √öJRAPR√ìB√ÅLKOZ√ÅS</button>
    </div>
    <div id="victory" class="screen" style="display:none">
        <h1 style="color: gold; font-size:70px;">üèÜ T√ñK√âLETES GY≈êZELEM! üèÜ</h1>
        <p>Mindenkit legy≈ëzt√©l! Te vagy a legjobb!</p>
        <button onclick="location.reload()">üîÑ √öJ KALAND</button>
    </div>
    <canvas id="c" width="900" height="540"></canvas> <!-- Nagyobb canvas -->
</div>
<script>
const canvas = document.getElementById("c"), ctx = canvas.getContext("2d");
ctx.imageSmoothingEnabled = false; // Pixel art st√≠lus
let active = false, currentLvl = 1, score = 0, hp = 3, cameraX = 0, frame = 0;
const spawnPoints = [100, 100, 100]; // Szint spawn X
// --- J√ÅT√âKOS ---
const mario = {
    x: 100, y: 300, w: 36, h: 52, vx: 0, vy: 0,
    onGround: false, dir: 1, power: false, fireballs: [],
    animFrame: 0
};
let platforms = [], enemies = [], items = [], clouds = [], hills = [];
// --- GRAFIKA √âS SZINTEK ---
function buildLevel(n) {
    platforms = []; enemies = []; items = []; clouds = []; hills = [];
    mario.x = spawnPoints[n-1] || 100; mario.y = 350; cameraX = 0;
    mario.power = false; document.getElementById("powerLabel").innerText = "";
    updateHearts();
    document.getElementById("lvlDisplay").innerText = n;
    // Felh≈ëk (parallax)
    for(let i = 0; i < 20; i++) {
        clouds.push({x: i * 500 + Math.random()*300, y: 60 + Math.random()*120, size: 40 + Math.random()*30, speed: 0.4 + Math.random()*0.4});
    }
    // DomboK (h√°tt√©r parallax)
    for(let i = 0; i < 12; i++) {
        hills.push({x: i * 600 + Math.random()*400, w: 250 + Math.random()*200, h: 60 + Math.random()*40});
    }
    // Nagy talaj minden szinten alap
    platforms.push({x: 0, y: 460, w: 5000, h: 80, type: 'ground'});
    if (n === 1) {
        // 1. szint: Blokkok sora, ellens√©gek, pipe
        for(let i=400; i<900; i+=50) {
            addBlock(i, 340, Math.random()>0.5 ? 'brick' : 'lucky');
        }
        addPipe(1100);
        addEnemy(550, 420);
        addEnemy(850, 420);
        addEnemy(1250, 420);
        addEnemy(1550, 420);
        platforms.push({x: 2800, y: 120, w: 50, h: 340, type: 'goal'});
    } else if (n === 2) {
        // 2. szint: Szakad√©kok, ugr√≥ platformok
        platforms = [{x: 0, y: 460, w: 1100, h: 80, type: 'ground'},
                     {x: 1450, y: 460, w: 2000, h: 80, type: 'ground'}];
        // Ugr√≥ platformok a szakad√©kban
        addBlock(950, 400, 'brick');
        addBlock(1050, 360, 'brick');
        addBlock(1150, 320, 'brick');
        addBlock(1250, 280, 'brick');
        addBlock(1400, 280, 'lucky');
        addPipe(1700);
        addEnemy(1650, 420);
        addEnemy(1950, 420);
        addEnemy(2250, 420);
        addEnemy(2550, 420);
        platforms.push({x: 3300, y: 120, w: 50, h: 340, type: 'goal'});
    } else {
        // 3. szint: Boss ar√©na
        platforms = [{x: 0, y: 460, w: 2500, h: 80, type: 'ground'}];
        // L√©pcs≈ë a boss el≈ëtt
        addBlock(800, 400, 'brick');
        addBlock(850, 350, 'brick');
        addBlock(900, 300, 'brick');
        addBlock(950, 250, 'lucky');
        // Boss
        enemies.push({x: 1600, y: 340, w: 120, h: 120, vx: -5, hp: 8, maxHp:8, type: 'boss', patrolMin: 1200, patrolMax: 2200});
    }
}
function addBlock(x, y, type) { platforms.push({x, y, w: 48, h: 48, type, used: false}); }
function addPipe(x) {
    platforms.push({x: x-10, y: 460, w: 68, h: 60, type: 'pipe_bottom'});
    platforms.push({x: x-10, y: 340, w: 68, h: 120, type: 'pipe'});
}
function addEnemy(x, y) { 
    enemies.push({x, y, w: 42, h: 42, vx: -3.5 + Math.random()*1, patrolMin: x-150, patrolMax: x+150, type: 'goomba'}); 
}
// --- HANGOK Jav√≠tva ---
const audio = new (window.AudioContext || window.webkitAudioContext)();
function playSfx(freq, type = 'square', duration = 0.1, vol = 0.1) {
    if (audio.state === 'suspended') audio.resume();
    const osc = audio.createOscillator(), gain = audio.createGain();
    osc.type = type;
    osc.frequency.value = freq;
    gain.gain.setValueAtTime(vol, audio.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audio.currentTime + duration);
    osc.connect(gain);
    gain.connect(audio.destination);
    osc.start();
    osc.stop(audio.currentTime + duration);
}
// Jump: playSfx(660, 'sine', 0.15);
// Coin: 880
// Stomp: 200
// Die: 100
// Fire: 800
// --- IR√ÅNY√çT√ÅS ---
const keys = {};
window.onkeydown = e => { 
    keys[e.code] = true; 
    if(e.code === 'Space') e.preventDefault();
};
window.onkeyup = e => keys[e.code] = false;
function startGame() {
    document.getElementById("menu").style.display = "none";
    buildLevel(1); 
    active = true; 
    loop();
}
function updateHearts() {
    let hearts = '';
    for(let i=0; i<3; i++) hearts += hp > i ? '‚ù§Ô∏è' : 'üíî';
    document.getElementById("hearts").innerHTML = hearts;
}
function update() {
    if (!active) return;
    frame++;
    mario.animFrame = (mario.animFrame + 1) % 40;
    // Mozg√°s (finomabb gyorsul√°s)
    if (keys["ArrowRight"]) { 
        mario.vx = Math.min(mario.vx + 0.8, 8); 
        mario.dir = 1; 
    } else if (keys["ArrowLeft"]) { 
        mario.vx = Math.max(mario.vx - 0.8, -8); 
        mario.dir = -1; 
    } else { 
        mario.vx *= 0.85; 
    }
    // Ugr√°s
    if (keys["Space"] && mario.onGround) {
        mario.vy = -19; 
        mario.onGround = false;
        playSfx(660, 'sine', 0.15);
    }
    // T≈±zgoly√≥
    if (keys["KeyF"] && mario.power && mario.fireballs.length < 5) {
        mario.fireballs.push({x: mario.x + (mario.dir > 0 ? 30 : 0), y: mario.y + 25, vx: mario.dir * 14, vy: -2 + Math.random()*2});
        playSfx(800, 'sawtooth', 0.08);
        keys["KeyF"] = false;
    }
    mario.vy += 1.0; // Gravit√°ci√≥
    mario.x += mario.vx;
    mario.y += mario.vy;
    // Kamera (k√∂z√©pre igaz√≠tva)
    cameraX = Math.max(0, Math.min(4500 - 900, mario.x - 450));
    // Fizika & √útk√∂z√©sek (jav√≠tva: oldals√≥ + vertical)
    mario.onGround = false;
    platforms.forEach(p => {
        if (mario.x < p.x + p.w && mario.x + mario.w > p.x &&
            mario.y < p.y + p.h && mario.y + mario.h > p.y) {
            // Alulr√≥l landol√°s
            if (mario.vy > 0 && mario.y < p.y) {
                mario.y = p.y - mario.h;
                mario.vy = 0;
                mario.onGround = true;
            }
            // Fel√ºlr≈ël √ºtk√∂z√©s
            else if (mario.vy < 0 && mario.y > p.y) {
                mario.y = p.y + p.h;
                mario.vy = 0;
                if (p.type === 'lucky' && !p.used) {
                    p.used = true;
                    items.push({x: p.x + 10, y: p.y - 45, type: 'mushroom'});
                    playSfx(880, 'sine', 0.25);
                }
            }
            // Oldals√≥ √ºtk√∂z√©sek
            else {
                if (mario.vx > 0 && mario.x < p.x) {
                    mario.x = p.x - mario.w;
                    mario.vx = 0;
                } else if (mario.vx < 0 && mario.x + mario.w > p.x + p.w) {
                    mario.x = p.x + p.w;
                    mario.vx = 0;
                }
            }
            // C√©l
            if (p.type === 'goal') nextLvl();
        }
    });
    // Items (filter safe)
    items = items.filter(it => {
        it.y += 1; // lebeg felfel√© kicsit
        if (mario.x < it.x + 32 && mario.x + mario.w > it.x &&
            mario.y < it.y + 32 && mario.y + mario.h > it.y) {
            mario.power = true;
            document.getElementById("powerLabel").innerText = "üî• T≈∞Z MARIO! üî•";
            playSfx(1000, 'sine', 0.4);
            return false;
        }
        return it.y < 500;
    });
    // Ellens√©gek mozg√°s
    enemies.forEach(en => {
        en.x += en.vx;
        if (en.type !== 'boss') {
            if (en.x < en.patrolMin || en.x > en.patrolMax) en.vx *= -1;
        } else {
            if (en.x < en.patrolMin || en.x > en.patrolMax) en.vx *= -1;
        }
    });
    // Mario - ellens√©g √ºtk√∂z√©s (backward loop safe splice)
    for (let i = enemies.length - 1; i >= 0; i--) {
        const en = enemies[i];
        if (mario.x < en.x + en.w && mario.x + mario.w > en.x &&
            mario.y < en.y + en.h && mario.y + mario.h > en.y) {
            if (mario.vy > 0 && mario.y < en.y + 15) { // Fel√ºlr≈ël stomp
                if (en.type === 'boss') {
                    en.hp--;
                    mario.vy = -17;
                    playSfx(150, 'sawtooth', 0.2);
                    if (en.hp <= 0) {
                        score += 5000;
                        win();
                    }
                } else {
                    enemies.splice(i, 1);
                    mario.vy = -14;
                    score += 200;
                    playSfx(220, 'sine', 0.15);
                }
            } else {
                die();
            }
        }
    }
    // T≈±zgoly√≥k (filter safe)
    mario.fireballs = mario.fireballs.filter(fb => {
        fb.x += fb.vx;
        fb.y += fb.vy;
        fb.vy += 0.6;
        if (fb.y > 450) {
            fb.vy *= -0.6; // bounce
        }
        // Ellens√©g hit
        for (let ei = 0; ei < enemies.length; ei++) {
            const en = enemies[ei];
            if (fb.x < en.x + en.w && fb.x + 16 > en.x &&
                fb.y < en.y + en.h && fb.y + 16 > en.y) {
                if (en.type === 'boss') {
                    en.hp -= 1;
                    playSfx(300, 'sawtooth', 0.1);
                } else {
                    enemies.splice(ei, 1);
                    score += 150;
                }
                return false;
            }
        }
        return fb.x > cameraX - 100 && fb.x < cameraX + 1000;
    });
    // Hal√°l
    if (mario.y > 600) die();
    document.getElementById("scDisplay").innerText = score;
}
function die() {
    playSfx(80, 'square', 0.5);
    hp--;
    updateHearts();
    if (hp <= 0) {
        active = false;
        document.getElementById("fail").style.display = "flex";
    } else {
        mario.x = cameraX + 80;
        mario.y = 350;
        mario.vx = 0; mario.vy = 0;
        mario.power = false;
        document.getElementById("powerLabel").innerText = "";
        mario.fireballs = [];
    }
}
function nextLvl() {
    currentLvl++;
    if (currentLvl > 3) win();
    else {
        playSfx(1200, 'sine', 0.5);
        buildLevel(currentLvl);
    }
}
function win() {
    active = false;
    score += 10000;
    document.getElementById("victory").style.display = "flex";
    playSfx(880, 'sine', 1.0);
}
function drawMario() {
    const x = mario.x - cameraX, y = mario.y;
    const footBob = mario.onGround && Math.abs(mario.vx) > 1 ? Math.sin(frame * 0.4) * 3 : 0;
    // Sapka
    ctx.fillStyle = mario.power ? '#ff8c00' : '#e31b23';
    ctx.fillRect(x + 5, y + 1, 26, 14);
    ctx.fillStyle = 'white';
    ctx.font = 'bold 11px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('M', x + 18, y + 12);
    // Fej
    ctx.fillStyle = '#ffdbac';
    ctx.fillRect(x + 7, y + 15, 22, 18);
    // Szemek (dir alapj√°n)
    ctx.fillStyle = 'black';
    const eye1 = mario.dir > 0 ? x + 18 : x + 10;
    const eye2 = mario.dir > 0 ? x + 23 : x + 15;
    ctx.fillRect(eye1, y + 21, 4, 4);
    ctx.fillRect(eye2, y + 21, 4, 4);
    // Bajusz
    ctx.fillRect(x + 11, y + 28, 14, 4);
    // Overall
    ctx.fillStyle = mario.power ? '#ffd700' : '#d81e05';
    ctx.fillRect(x + 3, y + 29, 30, 18);
    // Gombok
    ctx.fillStyle = 'yellow';
    ctx.fillRect(x + 10, y + 33, 6, 6);
    ctx.fillRect(x + 20, y + 33, 6, 6);
    // Keszty≈±k
    ctx.fillStyle = 'white';
    ctx.fillRect(x + 1, y + 33, 8, 10);
    ctx.fillRect(x + 27, y + 33, 8, 10);
    // Cip≈ëk (anim)
    ctx.fillStyle = '#8b4513';
    ctx.fillRect(x + 4 + (footBob > 0 ? 2 : 0), y + 44 + Math.abs(footBob), 11, 8);
    ctx.fillRect(x + 21 - (footBob > 0 ? 2 : 0), y + 44 - Math.abs(footBob), 11, 8);
    ctx.textAlign = 'left';
}
function drawGoomba(en) {
    const ex = en.x - cameraX, ey = en.y;
    // Test (ov√°l hat√°s√∫)
    ctx.fillStyle = '#654321';
    ctx.fillRect(ex + 4, ey + 8, 34, 28);
    ctx.fillStyle = '#8b7355';
    ctx.fillRect(ex + 6, ey + 10, 30, 24);
    // Szemek
    ctx.fillStyle = 'white';
    ctx.fillRect(ex + 10, ey + 14, 8, 8);
    ctx.fillRect(ex + 24, ey + 14, 8, 8);
    ctx.fillStyle = 'black';
    ctx.fillRect(ex + 12, ey + 16, 4, 4);
    ctx.fillRect(ex + 26, ey + 16, 4, 4);
    // L√°bak (s√©ta anim)
    const legFrame = Math.floor(frame / 10) % 2;
    ctx.fillStyle = '#5c4033';
    ctx.fillRect(ex + 8, ey + 32, 6, 10 - legFrame * 3);
    ctx.fillRect(ex + 28, ey + 32, 6, 10 + legFrame * 3);
}
function drawBoss(en) {
    const bx = en.x - cameraX, by = en.y;
    // Test (nagy barna/s√∂t√©t)
    ctx.fillStyle = '#4b0082';
    ctx.fillRect(bx, by + 20, 120, 100);
    ctx.fillStyle = '#663399';
    ctx.fillRect(bx + 10, by + 25, 100, 80);
    // Szem
    ctx.fillStyle = 'yellow';
    ctx.fillRect(bx + 40, by + 35, 40, 25);
    ctx.fillStyle = 'black';
    ctx.fillRect(bx + 50, by + 42, 20, 12);
    // T√ºske
    ctx.fillStyle = '#8b4513';
    ctx.beginPath();
    ctx.moveTo(bx + 60, by + 20);
    ctx.lineTo(bx + 80, by + 5);
    ctx.lineTo(bx + 100, by + 20);
    ctx.fill();
    // HP bar
    ctx.fillStyle = 'red';
    ctx.fillRect(bx, by - 15, 120, 8);
    ctx.fillStyle = 'lime';
    ctx.fillRect(bx, by - 15, 120 * (en.hp / en.maxHp), 8);
}
function render() {
    ctx.clearRect(0, 0, 900, 540);
    ctx.save();
    ctx.translate(-cameraX, 0);
    // DomboK
    ctx.fillStyle = '#228b22';
    ctx.strokeStyle = '#006400';
    ctx.lineWidth = 2;
    hills.forEach(h => {
        const hx = h.x - cameraX * 0.3;
        ctx.beginPath();
        ctx.moveTo(hx, 460);
        ctx.quadraticCurveTo(hx + h.w / 2, 460 - h.h, hx + h.w, 460);
        ctx.stroke();
        ctx.fill();
    });
    // Platformok (jav√≠tott design)
    platforms.forEach(p => {
        const px = p.x, py = p.y;
        if (p.type === 'ground' || p.type === 'grass') {
            // F√∂ld text√∫ra
            ctx.fillStyle = '#8b4513';
            ctx.fillRect(px, py, p.w, p.h);
            ctx.fillStyle = '#228b22';
            ctx.fillRect(px, py, p.w, 20);
            // F≈±sz√°lak
            ctx.fillStyle = '#006400';
            for(let i = 0; i < p.w; i += 8) {
                ctx.fillRect(px + i, py - 2 + Math.sin(frame * 0.1 + i) * 1, 4, 8);
            }
        } else if (p.type === 'brick') {
            ctx.fillStyle = '#cd853f';
            ctx.fillRect(px, py, p.w, p.h);
            ctx.strokeStyle = '#8b4513';
            ctx.lineWidth = 2;
            for(let i = 0; i < 2; i++) {
                for(let j = 0; j < 2; j++) {
                    ctx.strokeRect(px + i * 24, py + j * 24, 23, 23);
                }
            }
        } else if (p.type === 'lucky') {
            const glow = 200 + Math.sin(frame * 0.15) * 55;
            ctx.fillStyle = `hsl(${glow/2}, 100%, 50%)`;
            ctx.fillRect(px, py, p.w, p.h);
            ctx.fillStyle = 'white';
            ctx.font = 'bold 28px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('?', px + 24, py + 24);
        } else if (p.type === 'pipe') {
            ctx.fillStyle = '#006400';
            ctx.fillRect(px, py, p.w, p.h);
            ctx.fillStyle = '#228b22';
            ctx.fillRect(px + 8, py, p.w - 16, p.h);
        } else if (p.type === 'pipe_bottom') {
            ctx.fillStyle = '#004d00';
            ctx.fillRect(px, py, p.w, p.h);
            ctx.fillStyle = '#228b22';
            ctx.fillRect(px + 12, py - 8, p.w - 24, 12);
        } else if (p.type === 'goal') {
            // Z√°szl√≥r√∫d
            ctx.fillStyle = '#a52a2a';
            ctx.fillRect(px - 15, py, 15, p.h);
            // Z√°szl√≥ (leng)
            const flagY = py + 30 + Math.sin(frame * 0.1) * 15;
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.moveTo(px, flagY);
            ctx.lineTo(px - 35, flagY + 20);
            ctx.lineTo(px, flagY + 10);
            ctx.fill();
            ctx.fillStyle = 'black';
            ctx.fillRect(px - 10, py + 10, 60, 20);
        }
    });
    // Items (gomba)
    items.forEach(it => {
        const ix = it.x, iy = it.y;
        // Gombatest
        ctx.fillStyle = 'white';
        ctx.beginPath();
        ctx.ellipse(ix + 16, iy + 12, 14, 10, 0, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = '#ff4444';
        ctx.beginPath();
        ctx.ellipse(ix + 16, iy + 12, 10, 7, 0, 0, Math.PI * 2);
        ctx.fill();
        // Sz√°r
        ctx.fillStyle = 'white';
        ctx.fillRect(ix + 14, iy + 20, 8, 12);
    });
    // Ellens√©gek
    enemies.forEach(en => {
        if (en.type === 'goomba') drawGoomba(en);
        else drawBoss(en);
    });
    // T≈±zgoly√≥k
    mario.fireballs.forEach(fb => {
        const fx = fb.x - cameraX, fy = fb.y;
        ctx.fillStyle = 'orange';
        ctx.shadowBlur = 15;
        ctx.shadowColor = 'red';
        ctx.beginPath();
        ctx.arc(fx + 8, fy + 8, 10, 0, Math.PI * 2);
        ctx.fill();
        ctx.shadowBlur = 0;
        // Cs√≠k
        ctx.strokeStyle = 'yellow';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(fx + 8, fy + 8);
        ctx.lineTo(fx + 8 - fb.vx * 0.5, fy + 8 - fb.vy * 0.5);
        ctx.stroke();
    });
    // Mario
    drawMario();
    ctx.restore();
}
function loop() {
    if (!active) return;
    update();
    render();
    requestAnimationFrame(loop);
}
</script>
</body>
</html>
