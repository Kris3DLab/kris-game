<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>Szuper Mario - Teljes Verzió</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Press Start 2P', 'Courier New', monospace;
            overflow: hidden;
        }
        #game-container {
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            border: 6px solid #2c3e50;
            border-radius: 15px;
            overflow: hidden;
            background: #000;
        }
        canvas {
            display: block;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }
        
        /* UI Elemek */
        #game-ui {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            display: flex;
            justify-content: space-between;
            color: white;
            font-size: 14px;
            text-shadow: 2px 2px 0 #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000;
            pointer-events: none;
            z-index: 10;
        }
        .ui-item { display: flex; align-items: center; gap: 8px; }
        .coin { color: #ffd700; }
        .heart { color: #ff0000; }
        
        /* Menü rendszer */
        .overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 100;
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .menu-title {
            font-size: 48px;
            margin-bottom: 30px;
            color: #ff4444;
            text-shadow: 4px 4px 0 #000, -2px -2px 0 #ffd700;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .menu-subtitle {
            font-size: 12px;
            margin-bottom: 30px;
            color: #aaa;
        }
        
        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        
        button {
            padding: 15px 40px;
            font-size: 16px;
            font-family: inherit;
            cursor: pointer;
            background: linear-gradient(180deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
            border: 3px solid #fff;
            border-radius: 10px;
            font-weight: bold;
            transition: all 0.2s;
            box-shadow: 0 5px 0 #c92a2a;
            position: relative;
            top: 0;
        }
        button:hover {
            background: linear-gradient(180deg, #ff8787 0%, #ff6b6b 100%);
            transform: translateY(-2px);
            box-shadow: 0 7px 0 #c92a2a;
        }
        button:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #c92a2a;
        }
        button.secondary {
            background: linear-gradient(180deg, #4dabf7 0%, #339af0 100%);
            box-shadow: 0 5px 0 #1971c2;
        }
        button.secondary:hover {
            background: linear-gradient(180deg, #74c0fc 0%, #4dabf7 100%);
            box-shadow: 0 7px 0 #1971c2;
        }
        
        /* Szint kiválasztó */
        .level-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        .level-button {
            width: 80px;
            height: 80px;
            padding: 0;
            font-size: 24px;
        }
        .level-button.locked {
            background: #555;
            cursor: not-allowed;
            opacity: 0.5;
        }
        
        /* Beállítások */
        .settings-grid {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 20px 0;
        }
        .setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-width: 400px;
            font-size: 12px;
        }
        .toggle {
            width: 60px;
            height: 30px;
            background: #555;
            border-radius: 15px;
            position: relative;
            cursor: pointer;
            transition: 0.3s;
        }
        .toggle.active {
            background: #4caf50;
        }
        .toggle-slider {
            width: 26px;
            height: 26px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: 0.3s;
        }
        .toggle.active .toggle-slider {
            left: 32px;
        }
        
        /* Statisztikák */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
            font-size: 12px;
        }
        .stat-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
        }
        .stat-label {
            color: #aaa;
            margin-bottom: 5px;
        }
        .stat-value {
            font-size: 18px;
            color: #ffd700;
        }
        
        /* Pause menü */
        #pause-menu {
            background: rgba(0, 0, 0, 0.95);
        }
        
        /* Folyamatjelző */
        .progress-bar {
            width: 300px;
            height: 20px;
            background: #333;
            border: 2px solid #fff;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            transition: width 0.3s;
        }
    </style>
</head>
<body>

<div id="game-container">
    <!-- Játék UI -->
    <div id="game-ui">
        <div class="ui-item">
            <span>VILÁG</span>
            <span id="world">1</span>
            <span>-</span>
            <span id="level">1</span>
        </div>
        <div class="ui-item">
            <span class="coin">●</span>
            <span id="coins">0</span>
        </div>
        <div class="ui-item">
            <span>PONT</span>
            <span id="score">0</span>
        </div>
        <div class="ui-item">
            <span class="heart">♥</span>
            <span id="lives">3</span>
        </div>
        <div class="ui-item">
            <span id="time">400</span>
        </div>
    </div>

    <!-- Főmenü -->
    <div id="main-menu" class="overlay">
        <div class="menu-title">SZUPER MARIO</div>
        <div class="menu-subtitle">Teljes Magyar Verzió</div>
        <div class="menu-buttons">
            <button onclick="showLevelSelect()">ÚJ JÁTÉK</button>
            <button onclick="continueGame()" id="continue-btn" style="display:none">FOLYTATÁS</button>
            <button class="secondary" onclick="showSettings()">BEÁLLÍTÁSOK</button>
            <button class="secondary" onclick="showStats()">STATISZTIKÁK</button>
            <button class="secondary" onclick="showControls()">IRÁNYÍTÁS</button>
        </div>
    </div>

    <!-- Szint választó -->
    <div id="level-select" class="overlay" style="display:none">
        <div class="menu-title" style="font-size:36px">SZINT VÁLASZTÁS</div>
        <div class="level-grid" id="level-grid"></div>
        <button class="secondary" onclick="showMainMenu()" style="margin-top:20px">VISSZA</button>
    </div>

    <!-- Beállítások -->
    <div id="settings-menu" class="overlay" style="display:none">
        <div class="menu-title" style="font-size:36px">BEÁLLÍTÁSOK</div>
        <div class="settings-grid">
            <div class="setting-row">
                <span>HANGEFFEKTEK</span>
                <div class="toggle active" onclick="toggleSetting(this, 'sound')">
                    <div class="toggle-slider"></div>
                </div>
            </div>
            <div class="setting-row">
                <span>ZENE</span>
                <div class="toggle active" onclick="toggleSetting(this, 'music')">
                    <div class="toggle-slider"></div>
                </div>
            </div>
            <div class="setting-row">
                <span>RÉSZECSKÉK</span>
                <div class="toggle active" onclick="toggleSetting(this, 'particles')">
                    <div class="toggle-slider"></div>
                </div>
            </div>
            <div class="setting-row">
                <span>NEHÉZSÉG</span>
                <select id="difficulty" style="padding:8px; font-family:inherit; font-size:12px;">
                    <option value="easy">KÖNNYŰ</option>
                    <option value="normal" selected>NORMÁL</option>
                    <option value="hard">NEHÉZ</option>
                </select>
            </div>
        </div>
        <button class="secondary" onclick="showMainMenu()">VISSZA</button>
    </div>

    <!-- Statisztikák -->
    <div id="stats-menu" class="overlay" style="display:none">
        <div class="menu-title" style="font-size:36px">STATISZTIKÁK</div>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-label">ÖSSZEGYŰJTÖTT ÉRME</div>
                <div class="stat-value" id="total-coins">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">LEGYŐZÖTT ELLENSÉG</div>
                <div class="stat-value" id="total-enemies">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">LEGMAGASABB PONT</div>
                <div class="stat-value" id="high-score">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">JÁTÉKIDŐ</div>
                <div class="stat-value" id="play-time">0:00</div>
            </div>
        </div>
        <button class="secondary" onclick="showMainMenu()">VISSZA</button>
    </div>

    <!-- Irányítás -->
    <div id="controls-menu" class="overlay" style="display:none">
        <div class="menu-title" style="font-size:36px">IRÁNYÍTÁS</div>
        <div style="text-align:left; font-size:14px; line-height:2; margin:20px 0;">
            <p>← →  : MOZGÁS</p>
            <p>SPACE : UGRÁS</p>
            <p>F     : TŰZ (ha van virág)</p>
            <p>ESC   : SZÜNET</p>
            <p>R     : ÚJRAINDÍTÁS</p>
        </div>
        <button class="secondary" onclick="showMainMenu()">VISSZA</button>
    </div>

    <!-- Pause menü -->
    <div id="pause-menu" class="overlay" style="display:none">
        <div class="menu-title" style="font-size:36px">SZÜNET</div>
        <div class="menu-buttons">
            <button onclick="resumeGame()">FOLYTATÁS</button>
            <button class="secondary" onclick="restartLevel()">ÚJRAINDÍTÁS</button>
            <button class="secondary" onclick="quitToMenu()">FŐMENÜ</button>
        </div>
    </div>

    <!-- Game Over -->
    <div id="game-over" class="overlay" style="display:none">
        <div class="menu-title">GAME OVER</div>
        <div style="font-size:14px; margin:20px 0;">
            <p>VÉGSŐ PONTSZÁM: <span id="final-score">0</span></p>
        </div>
        <div class="menu-buttons">
            <button onclick="restartLevel()">ÚJRA</button>
            <button class="secondary" onclick="quitToMenu()">FŐMENÜ</button>
        </div>
    </div>

    <!-- Győzelem -->
    <div id="victory" class="overlay" style="display:none">
        <div class="menu-title" style="color:#ffd700">GYŐZELEM!</div>
        <div style="font-size:14px; margin:20px 0;">
            <p>GRATULÁLUNK!</p>
            <p style="margin-top:10px">PONTSZÁM: <span id="victory-score">0</span></p>
        </div>
        <div class="menu-buttons">
            <button onclick="nextLevel()">KÖVETKEZŐ SZINT</button>
            <button class="secondary" onclick="quitToMenu()">FŐMENÜ</button>
        </div>
    </div>

    <canvas id="canvas" width="800" height="480"></canvas>
</div>

<script>
// =============== JÁTÉK MOTOR ===============
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

// Játék állapot
const game = {
    state: 'menu', // menu, playing, paused, gameover, victory
    world: 1,
    level: 1,
    score: 0,
    coins: 0,
    lives: 3,
    time: 400,
    frameCount: 0,
    camera: { x: 0, y: 0 },
    settings: {
        sound: true,
        music: true,
        particles: true,
        difficulty: 'normal'
    },
    stats: {
        totalCoins: 0,
        totalEnemies: 0,
        highScore: 0,
        playTime: 0
    }
};

// Játékos
const player = {
    x: 50,
    y: 350,
    w: 32,
    h: 44,
    vx: 0,
    vy: 0,
    speed: 4.5,
    jumpPower: 15,
    grounded: false,
    direction: 1,
    powerup: 'normal', // normal, super, fire
    invincible: 0,
    animFrame: 0
};

// Játék objektumok
let blocks = [];
let enemies = [];
let items = [];
let particles = [];
let projectiles = [];

// Billentyűzet
const keys = {};
window.addEventListener('keydown', e => {
    keys[e.code] = true;
    if (e.code === 'Escape' && game.state === 'playing') togglePause();
    if (e.code === 'KeyR') restartLevel();
});
window.addEventListener('keyup', e => keys[e.code] = false);

// =============== MENÜ RENDSZER ===============
function showMainMenu() {
    hideAllMenus();
    document.getElementById('main-menu').style.display = 'flex';
    game.state = 'menu';
}

function showLevelSelect() {
    hideAllMenus();
    document.getElementById('level-select').style.display = 'flex';
    renderLevelGrid();
}

function showSettings() {
    hideAllMenus();
    document.getElementById('settings-menu').style.display = 'flex';
}

function showStats() {
    hideAllMenus();
    document.getElementById('stats-menu').style.display = 'flex';
    updateStatsDisplay();
}

function showControls() {
    hideAllMenus();
    document.getElementById('controls-menu').style.display = 'flex';
}

function hideAllMenus() {
    document.querySelectorAll('.overlay').forEach(el => el.style.display = 'none');
}

function renderLevelGrid() {
    const grid = document.getElementById('level-grid');
    grid.innerHTML = '';
    const maxLevel = 9;
    for (let i = 1; i <= maxLevel; i++) {
        const btn = document.createElement('button');
        btn.className = 'level-button';
        btn.textContent = i;
        btn.onclick = () => startLevel(1, i);
        grid.appendChild(btn);
    }
}

function toggleSetting(element, setting) {
    element.classList.toggle('active');
    game.settings[setting] = element.classList.contains('active');
}

function updateStatsDisplay() {
    document.getElementById('total-coins').textContent = game.stats.totalCoins;
    document.getElementById('total-enemies').textContent = game.stats.totalEnemies;
    document.getElementById('high-score').textContent = game.stats.highScore;
    const mins = Math.floor(game.stats.playTime / 60);
    const secs = game.stats.playTime % 60;
    document.getElementById('play-time').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
}

// =============== JÁTÉK INDÍTÁS ===============
function startLevel(world, level) {
    game.world = world;
    game.level = level;
    game.time = 400;
    game.state = 'playing';
    
    hideAllMenus();
    
    // Játékos reset
    player.x = 50;
    player.y = 350;
    player.vx = 0;
    player.vy = 0;
    player.powerup = 'normal';
    player.direction = 1;
    
    // Kamera reset
    game.camera.x = 0;
    
    // Pálya betöltése
    loadLevel(level);
    
    // UI frissítés
    updateUI();
    
    // Játék loop indítása
    gameLoop();
}

function loadLevel(levelNum) {
    blocks = [];
    enemies = [];
    items = [];
    particles = [];
    projectiles = [];
    
    // Alap talaj
    addBlock(0, 420, 5000, 60, 'ground');
    
    // Szintek
    if (levelNum === 1) {
        // Kezdő szint
        addBlock(300, 350, 40, 40, 'brick');
        addBlock(340, 350, 40, 40, 'question');
        addBlock(380, 350, 40, 40, 'brick');
        
        addBlock(500, 280, 40, 40, 'question');
        
        addBlock(700, 350, 40, 40, 'brick');
        addBlock(740, 350, 40, 40, 'brick');
        addBlock(780, 350, 40, 40, 'brick');
        addBlock(740, 280, 40, 40, 'question');
        
        // Szakadék
        blocks = blocks.filter(b => b.type !== 'ground' || b.x < 1000 || b.x > 1300);
        addBlock(1400, 420, 3600, 60, 'ground');
        
        // Platform a szakadék felett
        addBlock(1100, 320, 120, 20, 'platform');
        
        // Ellenségek
        addEnemy(400, 380, 'goomba');
        addEnemy(850, 380, 'goomba');
        addEnemy(1500, 380, 'koopa');
        
        // Cél
        addBlock(2200, 180, 40, 240, 'flag');
        
    } else if (levelNum === 2) {
        // Platformok
        for (let i = 0; i < 5; i++) {
            addBlock(300 + i * 200, 380 - i * 40, 100, 20, 'platform');
        }
        
        addBlock(600, 280, 40, 40, 'question');
        addBlock(900, 200, 40, 40, 'question');
        
        addEnemy(500, 340, 'goomba');
        addEnemy(1000, 120, 'goomba');
        
        addBlock(1800, 180, 40, 240, 'flag');
        
    } else if (levelNum === 3) {
        // Boss szint
        addBlock(500, 350, 200, 20, 'platform');
        addBlock(900, 280, 200, 20, 'platform');
        addBlock(1300, 350, 200, 20, 'platform');
        
        addEnemy(800, 200, 'boss');
        
        addBlock(1800, 180, 40, 240, 'flag');
        
    } else {
        // Generált szintek
        for (let i = 0; i < 10; i++) {
            const x = 300 + i * 200;
            const y = 350 - Math.random() * 100;
            addBlock(x, y, 40, 40, Math.random() > 0.5 ? 'brick' : 'question');
            
            if (Math.random() > 0.6) {
                addEnemy(x + 100, 380, Math.random() > 0.5 ? 'goomba' : 'koopa');
            }
        }
        
        addBlock(2500, 180, 40, 240, 'flag');
    }
}

function addBlock(x, y, w, h, type) {
    blocks.push({ x, y, w, h, type, used: false });
}

function addEnemy(x, y, type) {
    const enemy = { x, y, vx: -1.5, type, alive: true };
    
    if (type === 'goomba') {
        enemy.w = 32;
        enemy.h = 32;
    } else if (type === 'koopa') {
        enemy.w = 32;
        enemy.h = 44;
        enemy.shell = false;
    } else if (type === 'boss') {
        enemy.w = 80;
        enemy.h = 80;
        enemy.hp = 5;
        enemy.vx = -2;
    }
    
    enemies.push(enemy);
}

// =============== JÁTÉK LOOP ===============
function gameLoop() {
    if (game.state !== 'playing') return;
    
    update();
    render();
    
    requestAnimationFrame(gameLoop);
}

function update() {
    game.frameCount++;
    
    // Időzítő
    if (game.frameCount % 60 === 0) {
        game.time--;
        if (game.time <= 0) {
            die();
        }
    }
    
    // Játékos vezérlés
    if (keys['ArrowRight']) {
        player.vx = player.speed;
        player.direction = 1;
        player.animFrame = (game.frameCount % 20 < 10) ? 0 : 1;
    } else if (keys['ArrowLeft']) {
        player.vx = -player.speed;
        player.direction = -1;
        player.animFrame = (game.frameCount % 20 < 10) ? 0 : 1;
    } else {
        player.vx *= 0.85;
        player.animFrame = 0;
    }
    
    if (keys['Space'] && player.grounded) {
        player.vy = -player.jumpPower;
        player.grounded = false;
    }
    
    if (keys['KeyF'] && player.powerup === 'fire') {
        if (projectiles.length < 2 && game.frameCount % 15 === 0) {
            projectiles.push({
                x: player.x + (player.direction > 0 ? player.w : 0),
                y: player.y + 10,
                vx: player.direction * 8,
                vy: 0,
                w: 8,
                h: 8
            });
        }
    }
    
    // Gravitáció
    player.vy += 0.8;
    player.x += player.vx;
    player.y += player.vy;
    
    // Kamera követés
    game.camera.x = Math.max(0, player.x - 300);
    
    // Ütközés detektálás - blokkok
    player.grounded = false;
    blocks.forEach(block => {
        if (checkCollision(player, block)) {
            if (block.type === 'flag') {
                levelComplete();
                return;
            }
            
            // Függőleges ütközés
            if (player.vy > 0) {
                // Alulról ütközés
                player.y = block.y - player.h;
                player.vy = 0;
                player.grounded = true;
            } else if (player.vy < 0) {
                // Felülről ütközés
                player.y = block.y + block.h;
                player.vy = 1;
                
                // Blokk aktiválás
                if (block.type === 'question' && !block.used) {
                    block.used = true;
                    block.type = 'used';
                    spawnItem(block.x, block.y - 40);
                    game.score += 100;
                    createParticles(block.x + 20, block.y, '#ffd700');
                } else if (block.type === 'brick' && player.powerup !== 'normal') {
                    block.destroyed = true;
                    game.score += 50;
                    createParticles(block.x + 20, block.y + 20, '#a52a2a');
                }
            }
            
            // Vízszintes ütközés
            if (player.vx > 0) {
                player.x = block.x - player.w;
            } else if (player.vx < 0) {
                player.x = block.x + block.w;
            }
        }
    });
    
    // Blokkok eltávolítása
    blocks = blocks.filter(b => !b.destroyed);
    
    // Tárgyak
    items.forEach((item, i) => {
        if (checkCollision(player, item)) {
            if (item.type === 'coin') {
                game.coins++;
                game.stats.totalCoins++;
                game.score += 200;
            } else if (item.type === 'mushroom') {
                if (player.powerup === 'normal') player.powerup = 'super';
                game.score += 1000;
            } else if (item.type === 'flower') {
                player.powerup = 'fire';
                game.score += 1000;
            }
            items.splice(i, 1);
            createParticles(item.x, item.y, '#ffd700');
        }
    });
    
    // Ellenségek
    enemies.forEach((enemy, i) => {
        if (!enemy.alive) return;
        
        enemy.x += enemy.vx;
        
        // Falról visszapattanás
        blocks.forEach(block => {
            if (checkCollision(enemy, block)) {
                enemy.vx *= -1;
            }
        });
        
        // Játékos ütközés
        if (checkCollision(player, enemy)) {
            if (player.vy > 0 && player.y < enemy.y) {
                // Rátapos
                if (enemy.type === 'boss') {
                    enemy.hp--;
                    if (enemy.hp <= 0) {
                        enemy.alive = false;
                        game.score += 5000;
                        game.stats.totalEnemies++;
                    }
                    player.vy = -12;
                } else {
                    enemy.alive = false;
                    player.vy = -10;
                    game.score += 500;
                    game.stats.totalEnemies++;
                    createParticles(enemy.x, enemy.y, '#8b4513');
                }
            } else {
                // Eltalál
                if (player.invincible === 0) {
                    hit();
                }
            }
        }
    });
    
    // Lövedékek
    projectiles.forEach((proj, i) => {
        proj.x += proj.vx;
        proj.vy += 0.3;
        proj.y += proj.vy;
        
        // Ellenség találat
        enemies.forEach(enemy => {
            if (enemy.alive && checkCollision(proj, enemy)) {
                if (enemy.type === 'boss') {
                    enemy.hp--;
                    if (enemy.hp <= 0) {
                        enemy.alive = false;
                        game.score += 5000;
                    }
                } else {
                    enemy.alive = false;
                    game.score += 200;
                    game.stats.totalE
